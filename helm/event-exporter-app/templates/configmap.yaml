apiVersion: v1
kind: ConfigMap
metadata:
  name: event-exporter-app
  namespace: giantswarm
data:
  config.yaml: |
    logLevel: debug
    route:
      routes:
        # We want to send Tenant Cluster upgrade events to Slack via the webhook
        # receiver. Therefore we match for events attached to the CAPI Cluster
        # CRs.
        - match:
          - apiversion: "cluster.x-k8s.io/v1alpha2"
            kind: "Cluster"
            reason: "ClusterIsUpdating"
            receiver: "webhook"

        # We want to ignore all other events once we handled the events we are
        # actually interested in. Therefore the drop rule has to be evaluated at
        # the end of the tree.
        - drop:
          - namespace: "*"
    receivers:
      - name: "webhook"
        webhook:
          endpoint: "{{ .Values.webhook.endpoint }}"
          layout:
            text: "Tenant Cluster upgrade got triggered for {{ "{{" }} .InvolvedObject.Namespace {{ "}}" }}/{{ "{{" }} .InvolvedObject.Name {{ "}}" }} on {{ .Values.Installation.V1.Name }}."
